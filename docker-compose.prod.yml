# Snapper - Production Docker Compose Override
# Usage: docker compose -f docker-compose.yml -f docker-compose.prod.yml up -d --build
#
# All environment variables are now read from .env via ${VAR:-default} in the
# base compose. This file only overrides structural differences for production:
# build target, port binding, and volume mounts.
services:
  app:
    build:
      target: production
    ports: !override
      - "127.0.0.1:8000:8000"
    volumes: !reset []

  postgres:
    ports: !reset []

  redis:
    ports: !reset []

  caddy:
    # Only expose :8443 in prod â€” system Caddy owns :80/:443 for OpenClaw.
    # If SNAPPER_DOMAIN is set, add 80:80 and 443:443 manually or use deploy.sh.
    ports: !override
      - "${HTTPS_PORT:-8443}:8443"

  celery-worker:
    build:
      target: production
    volumes: !reset []

  celery-beat:
    build:
      target: production
    volumes: !reset []
