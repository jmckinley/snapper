# Snapper - Production Docker Compose Override
# Usage: docker compose -f docker-compose.yml -f docker-compose.prod.yml up -d --build
#
# All environment variables are now read from .env via ${VAR:-default} in the
# base compose. This file only overrides structural differences for production:
# build target, port binding, and volume mounts.
services:
  app:
    build:
      target: production
    ports: !override
      - "127.0.0.1:8000:8000"
    volumes: !reset []

  postgres:
    ports: !reset []

  redis:
    ports: !reset []

  caddy:
    # With SNAPPER_DOMAIN: serves on :80/:443 (Let's Encrypt)
    # Without: serves on :8443 (self-signed)
    ports: !override
      - "80:80"
      - "443:443"
      - "${HTTPS_PORT:-8443}:8443"

  celery-worker:
    build:
      target: production
    volumes: !reset []

  celery-beat:
    build:
      target: production
    volumes: !reset []
