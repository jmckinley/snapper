# Snapper - Caddy Reverse Proxy Configuration
#
# This file is the DEFAULT config for local development (self-signed cert).
# It is overwritten at runtime by caddy-entrypoint.sh based on environment:
#
#   No SNAPPER_DOMAIN → self-signed cert on https://localhost:8443 (this file)
#   SNAPPER_DOMAIN=snapper.example.com → auto Let's Encrypt on :443
#
# To use a real domain (no "Not Secure" warning):
#   1. Point your domain's DNS A record to your server IP
#   2. Set SNAPPER_DOMAIN in your .env file
#   3. docker compose up -d
#
# Caddy handles certificate provisioning and renewal automatically.

{
	auto_https disable_redirects
	servers :8443 {
		listener_wrappers {
			http_redirect
			tls
		}
	}
}

:8443 {
	tls internal

	header Strict-Transport-Security "max-age=31536000"

	reverse_proxy app:8000
}
